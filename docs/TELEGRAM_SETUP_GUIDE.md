# 📱 دليل إعداد إشعارات Telegram - الدليل الكامل

## 📋 المحتويات
1. [نظرة عامة](#نظرة-عامة)
2. [الخطوة 1: إنشاء Telegram Bot](#الخطوة-1-إنشاء-telegram-bot)
3. [الخطوة 2: الحصول على Bot Token](#الخطوة-2-الحصول-على-bot-token)
4. [الخطوة 3: إنشاء قناة أو الحصول على Chat ID](#الخطوة-3-إنشاء-قناة-أو-الحصول-على-chat-id)
5. [الخطوة 4: إضافة البوت للقناة](#الخطوة-4-إضافة-البوت-للقناة)
6. [الخطوة 5: تكوين النظام](#الخطوة-5-تكوين-النظام)
7. [الخطوة 6: اختبار الإشعارات](#الخطوة-6-اختبار-الإشعارات)
8. [أنواع الإشعارات](#أنواع-الإشعارات)
9. [استكشاف الأخطاء](#استكشاف-الأخطاء)

---

## 🎯 نظرة عامة

يتيح لك النظام استقبال إشعارات فورية على Telegram عندما تحدث أحداث مهمة مثل:
- 📋 مصروف جديد مقدم
- ✅ مصروف موافق عليه
- ❌ مصروف مرفوض
- 📄 عقد إيجار قارب على الانتهاء
- 💰 دفعة مستحقة قريباً
- 💳 شيك مستحق قريباً
- 🔄 عقد يحتاج تجديد

---

## الخطوة 1️⃣: إنشاء Telegram Bot

### 1. افتح تطبيق Telegram
- على الهاتف أو الكمبيوتر

### 2. ابحث عن BotFather
```
في شريط البحث، اكتب:
@BotFather
```

### 3. ابدأ محادثة مع BotFather
```
اضغط على زر "Start" أو أرسل:
/start
```

### 4. أنشئ بوت جديد
```
أرسل الأمر:
/newbot
```

### 5. قم بتسمية البوت

**BotFather سيطلب منك:**

```
Alright, a new bot. How are we going to call it? 
Please choose a name for your bot.
```

**أدخل اسم البوت (يمكن أن يكون باللغة العربية):**
```
EstateFlow Notifications
أو
إشعارات نظام إدارة العقارات
```

### 6. اختر اسم مستخدم للبوت

**BotFather سيطلب:**
```
Good. Now let's choose a username for your bot. 
It must end in `bot`.
```

**أدخل اسم مستخدم (يجب أن ينتهي بـ bot):**
```
estateflow_notify_bot
أو
my_estate_system_bot
```

**مثال كامل:**
```
You: EstateFlow Notifications
BotFather: Good. Now let's choose a username...

You: estateflow_notify_bot
BotFather: Done! Congratulations on your new bot...
```

---

## الخطوة 2️⃣: الحصول على Bot Token

بعد إنشاء البوت بنجاح، **BotFather** سيرسل لك رسالة تحتوي على **Bot Token**:

```
✅ Done! Congratulations on your new bot.
You will find it at t.me/estateflow_notify_bot.

Use this token to access the HTTP API:
1234567890:ABCdefGHIjklMNOpqrsTUVwxyz123456789

Keep your token secure and store it safely...
```

### 📝 انسخ الـ Token
**مثال Token:**
```
1234567890:ABCdefGHIjklMNOpqrsTUVwxyz123456789
```

⚠️ **مهم جداً:**
- احتفظ بهذا الرمز في مكان آمن
- لا تشاركه مع أي شخص
- هذا الرمز يمنح صلاحيات كاملة للبوت

---

## الخطوة 3️⃣: إنشاء قناة أو الحصول على Chat ID

لديك خياران:

### 🎯 الخيار 1: استخدام قناة Telegram (موصى به)

#### 1. أنشئ قناة جديدة

**على الهاتف:**
```
1. افتح Telegram
2. اذهب إلى: القوائم > قناة جديدة
3. أدخل اسم القناة (مثال: EstateFlow Alerts)
4. اختر نوع القناة: خاصة (Private)
5. اضغط إنشاء
```

**على الكمبيوتر:**
```
1. افتح Telegram Desktop
2. اضغط على القائمة ☰
3. اختر "قناة جديدة" (New Channel)
4. أدخل اسم القناة
5. اختر "خاصة" (Private)
6. اضغط إنشاء
```

#### 2. اجعل القناة عامة (مؤقتاً)

```
1. اذهب لإعدادات القناة
2. اختر "نوع القناة" (Channel Type)
3. اختر "عامة" (Public)
4. أدخل username للقناة (مثال: estateflow_alerts)
5. احفظ التغييرات
```

#### 3. احصل على Chat ID

**الطريقة 1: باستخدام username القناة**
```
إذا كان username القناة: estateflow_alerts

فإن Chat ID سيكون:
@estateflow_alerts
```

**الطريقة 2: باستخدام IDBot**
```
1. ابحث عن: @myidbot
2. أرسل له: /start
3. أرسل له: /getgroupid @estateflow_alerts
4. سيعطيك الرقم مثل: -1001234567890
```

#### 4. (اختياري) أعد القناة لخاصة

```
بعد الحصول على Chat ID:
1. ارجع لإعدادات القناة
2. اختر "خاصة" (Private)
3. احفظ التغييرات
```

---

### 🎯 الخيار 2: استخدام محادثة خاصة (للاستخدام الشخصي)

#### 1. احصل على User ID الخاص بك

```
1. ابحث عن البوت: @userinfobot
2. أرسل له: /start
3. سيعطيك معلوماتك بما فيها User ID
```

**مثال الرد:**
```
👤 Your User Info:

🆔 User ID: 123456789
👤 Name: أحمد محمد
📱 Username: @ahmed_user
```

#### 2. استخدم User ID كـ Chat ID

```
Chat ID = 123456789
```

---

## الخطوة 4️⃣: إضافة البوت للقناة

### إذا اخترت استخدام قناة:

**على الهاتف:**
```
1. افتح القناة التي أنشأتها
2. اضغط على اسم القناة في الأعلى
3. اختر "Administrators" (المديرين)
4. اضغط "Add Administrator" (إضافة مدير)
5. ابحث عن البوت الخاص بك (@estateflow_notify_bot)
6. أضفه كمدير
7. منحه صلاحية "Post Messages" (نشر الرسائل)
```

**على الكمبيوتر:**
```
1. افتح القناة
2. اضغط بالزر الأيمن على اسم القناة
3. اختر "Manage Channel" (إدارة القناة)
4. اذهب لـ "Administrators" (المديرين)
5. اضغط "Add Administrator"
6. ابحث عن البوت وأضفه
7. فعّل "Post Messages"
```

---

## الخطوة 5️⃣: تكوين النظام

### 🔧 الطريقة 1: من خلال إعدادات الموظف

#### 1. افتح صفحة إدارة الموظفين
```
http://localhost:5000/dashboard/employees
```

#### 2. عدّل معلومات الموظف
```
1. اضغط على زر "تعديل" للموظف المطلوب
2. مرر لأسفل حتى تجد قسم "إعدادات Telegram"
```

#### 3. أدخل المعلومات
```
┌─────────────────────────────────────────┐
│ إعدادات Telegram                        │
├─────────────────────────────────────────┤
│                                         │
│ رمز بوت تيليجرام:                      │
│ ┌─────────────────────────────────────┐ │
│ │ 1234567890:ABCdefGHIjklMNOpqrs... │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ معرف قناة تيليجرام:                    │
│ ┌─────────────────────────────────────┐ │
│ │ @estateflow_alerts                  │ │
│ │ أو                                  │ │
│ │ -1001234567890                      │ │
│ └─────────────────────────────────────┘ │
│                                         │
│ [حفظ التغييرات]                        │
└─────────────────────────────────────────┘
```

#### 4. احفظ التغييرات
```
اضغط على زر "حفظ التغييرات"
```

---

### 🔧 الطريقة 2: من خلال تفضيلات المستخدم (مستقبلاً)

```
http://localhost:5000/dashboard/user-preferences
```

---

## الخطوة 6️⃣: اختبار الإشعارات

### 1. افتح صفحة تفضيلات المستخدم
```
http://localhost:5000/dashboard/user-preferences
```

### 2. تحقق من حالة Telegram
```
✅ يجب أن ترى:
┌─────────────────────────────────────┐
│ 🤖 إشعارات Telegram                │
│                                     │
│ تلقى تنبيهات فورية على تيليجرام   │
│                                     │
│ [إرسال رسالة تجريبية] →            │
└─────────────────────────────────────┘
```

### 3. اضغط "إرسال رسالة تجريبية"

### 4. تحقق من Telegram
```
يجب أن تصل رسالة تجريبية:

🔔 EstateFlow - رسالة تجريبية

هذه رسالة تجريبية من نظام EstateFlow.
إذا استلمت هذه الرسالة، فإن الإشعارات تعمل بشكل صحيح! ✅

⏰ 2025-10-08 14:30
```

---

## 📬 أنواع الإشعارات

### يمكنك تفعيل/إيقاف الإشعارات التالية:

#### 1. 📋 مصروف جديد مقدم
```
📋 مصروف جديد مقدم

الموظف: أحمد محمد
الفئة: صيانة
المبلغ: AED 500
التاريخ: 2025-10-08

[عرض التفاصيل]
```

#### 2. ✅ مصروف موافق عليه
```
✅ تمت الموافقة على المصروف

رقم المصروف: EXP-001
المبلغ: AED 500
الموافق: مدير النظام

[عرض التفاصيل]
```

#### 3. ❌ مصروف مرفوض
```
❌ تم رفض المصروف

رقم المصروف: EXP-001
المبلغ: AED 500
السبب: لا يتوافق مع السياسة

[عرض التفاصيل]
```

#### 4. 📄 عقد إيجار قارب على الانتهاء
```
📄 تذكير: عقد إيجار ينتهي قريباً

العقار: شقة الشاطئ
المستأجر: محمد عبدالله
تاريخ الانتهاء: 2025-11-15
متبقي: 30 يوم

[عرض التفاصيل]
```

#### 5. 💰 دفعة مستحقة قريباً
```
💰 تذكير: دفعة مستحقة قريباً

المستأجر: أحمد سعيد
المبلغ: AED 5,000
تاريخ الاستحقاق: 2025-10-15
متبقي: 7 أيام

[عرض التفاصيل]
```

#### 6. 💳 شيك مستحق قريباً
```
💳 تذكير: شيك مستحق قريباً

المستفيد: شركة الصيانة
المبلغ: AED 10,000
رقم الشيك: 12345
تاريخ الاستحقاق: 2025-10-20
متبقي: 7 أيام

[عرض التفاصيل]
```

#### 7. 🔄 عقد يحتاج تجديد
```
🔄 تذكير: عقد صيانة يحتاج تجديد

المقاول: شركة الصيانة المتقدمة
نوع العقد: صيانة دورية
تاريخ الانتهاء: 2025-12-31
متبقي: 60 يوم

[عرض التفاصيل]
```

---

## ⚙️ ضبط تفضيلات الإشعارات

### 1. افتح تفضيلات الإشعارات
```
http://localhost:5000/dashboard/user-preferences
```

### 2. اختر أنواع الإشعارات التي تريدها
```
┌─────────────────────────────────────┐
│ ☑️ مصروف جديد مقدم                │
│ ☑️ مصروف موافق عليه                │
│ ☑️ مصروف مرفوض                     │
│ ☑️ عقد إيجار ينتهي قريباً          │
│    الأيام قبل: [90] يوم            │
│ ☑️ دفعة مستحقة قريباً              │
│    الأيام قبل: [7] يوم             │
│ ☑️ شيك مستحق قريباً                │
│    الأيام قبل: [7] يوم             │
│ ☑️ عقد يحتاج تجديد                 │
│    الأيام قبل: [60] يوم            │
└─────────────────────────────────────┘
```

### 3. اضبط المدة قبل الإشعار
```
مثال:
- عقد إيجار: 90 يوم قبل الانتهاء
- دفعة: 7 أيام قبل الاستحقاق
- شيك: 7 أيام قبل الاستحقاق
- تجديد عقد: 60 يوم قبل الانتهاء
```

### 4. احفظ التفضيلات
```
اضغط على زر "حفظ التفضيلات"
```

---

## 🔍 استكشاف الأخطاء

### ❌ المشكلة 1: لا تصل الإشعارات

**الحلول:**

✅ **تحقق من Bot Token:**
```
- تأكد أن Token صحيح
- تأكد أنه لا يوجد مسافات إضافية
- تأكد أنه كامل (ينتهي بـ ...)
```

✅ **تحقق من Chat ID:**
```
- إذا استخدمت @username تأكد من:
  • القناة عامة (Public)
  • Username صحيح
  • يبدأ بـ @

- إذا استخدمت رقم:
  • يبدأ بـ - للقنوات (مثال: -1001234567890)
  • لا يبدأ بـ - للمحادثات الخاصة (مثال: 123456789)
```

✅ **تحقق من إضافة البوت:**
```
- البوت مضاف كمدير للقناة
- البوت لديه صلاحية "Post Messages"
```

---

### ❌ المشكلة 2: خطأ "Chat not found"

**الحلول:**

1. **استخدم IDBot للحصول على Chat ID الصحيح:**
```
1. ابحث عن: @myidbot
2. أرسل: /getgroupid @your_channel_username
3. استخدم الرقم المعطى
```

2. **أو استخدم getUpdates API:**
```
1. أرسل رسالة في القناة
2. افتح المتصفح وأدخل:
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
3. ابحث عن "chat":{"id":-1001234567890}
4. استخدم هذا الرقم
```

---

### ❌ المشكلة 3: خطأ "Bot was blocked by the user"

**الحل:**
```
1. افتح محادثة خاصة مع البوت
2. اضغط "Start" أو "إلغاء الحظر"
3. أرسل أي رسالة للبوت
4. جرب مرة أخرى
```

---

### ❌ المشكلة 4: خطأ "Unauthorized"

**الحل:**
```
Bot Token غير صحيح:
1. ارجع لـ @BotFather
2. أرسل: /mybots
3. اختر البوت
4. اختر "API Token"
5. انسخ Token الجديد
6. حدّث النظام
```

---

## 📊 جدول مقارنة الخيارات

| الميزة | قناة خاصة | قناة عامة | محادثة خاصة |
|-------|----------|-----------|--------------|
| الأمان | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| سهولة الإعداد | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| مشاركة مع فريق | ✅ | ✅ | ❌ |
| سجل الرسائل | ✅ | ✅ | ✅ |
| موصى به | ✅ | ⚠️ | للاستخدام الشخصي |

---

## 📝 نصائح مهمة

### ✅ أفضل الممارسات:

1. **استخدم قناة خاصة** للأمان
2. **احفظ Bot Token في مكان آمن**
3. **لا تشارك Bot Token مع أحد**
4. **اختبر الإشعارات بعد الإعداد**
5. **فعّل الإشعارات التي تحتاجها فقط**
6. **اضبط المدة المناسبة للتذكيرات**

### ⚠️ تحذيرات:

1. ❌ لا تنشر Bot Token علناً
2. ❌ لا تضيف البوت لقنوات عامة غير موثوقة
3. ❌ لا تعطي صلاحيات إدارية كاملة للبوت
4. ⚠️ راجع الإشعارات بانتظام

---

## 🎯 ملخص سريع

### للإعداد السريع:

```bash
1. افتح @BotFather
   أرسل: /newbot

2. سمّ البوت: EstateFlow Bot
   Username: estateflow_notify_bot

3. انسخ Token:
   1234567890:ABCdefGHI...

4. أنشئ قناة: EstateFlow Alerts
   
5. أضف البوت كمدير

6. احصل على Chat ID:
   @estateflow_alerts
   أو -1001234567890

7. أدخل في النظام:
   - Bot Token
   - Chat ID

8. اختبر الإشعار!
```

---

## 📞 المساعدة الإضافية

### إذا واجهت مشاكل:

1. **راجع هذا الدليل بالكامل**
2. **تحقق من الأخطاء الشائعة**
3. **جرب الحلول المقترحة**
4. **اختبر الإعدادات خطوة بخطوة**

---

## 🎉 تهانينا!

بعد اكتمال الإعداد، ستستقبل إشعارات فورية على Telegram عن:
- ✅ جميع الأحداث المهمة
- ✅ التذكيرات في الوقت المناسب
- ✅ التنبيهات الفورية

**استمتع بإدارة أفضل لعقاراتك! 🏢📱**

---

**تاريخ التحديث:** أكتوبر 2025  
**الإصدار:** 1.0
