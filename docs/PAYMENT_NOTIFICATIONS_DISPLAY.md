# 💰 عرض الدفعات المستحقة - التقويم والإشعارات

## 📋 المحتويات
1. [عرض الدفعات في التقويم](#عرض-الدفعات-في-التقويم)
2. [عرض الدفعات في الإشعارات](#عرض-الدفعات-في-الإشعارات)
3. [البيانات المعروضة](#البيانات-المعروضة)
4. [أمثلة كاملة](#أمثلة-كاملة)

---

## 📅 عرض الدفعات في التقويم

### **المعلومات المعروضة:**

```
┌─────────────────────────────────────────┐
│ 💰 دفعة مستحقة                         │
├─────────────────────────────────────────┤
│ فيلا الشاطئ الذهبي (سكني)              │
│ مستأجر: محمد عبدالله العتيبي           │
│ المبلغ: AED 5,000                      │
│                                         │
│ [دفعة] 09:00                           │
└─────────────────────────────────────────┘
```

### **العناصر:**
1. **🎨 الأيقونة:** 💰 Banknote (أيقونة المال)
2. **🟢 اللون:** أخضر (bg-green-500)
3. **📍 العنوان:** "دفعة مستحقة" / "Payment Due"
4. **📝 التفاصيل:**
   - اسم العقار + نوعه (سكني/تجاري)
   - نوع المستأجر + اسمه
   - المبلغ المستحق

---

## 🔔 عرض الدفعات في الإشعارات

### **1. دفعة متأخرة (أحمر - Urgent)** 🔴

```
┌─────────────────────────────────────────┐
│ 🔴 دفعة متأخرة                         │
├─────────────────────────────────────────┤
│ عقار النخيل - شقة 101                  │
│ مستأجر: أحمد محمد الكعبي               │
│ المبلغ: AED 45,000                     │
│ متأخر: 15 يوم                          │
└─────────────────────────────────────────┘
```

**الخصائص:**
- ✅ خلفية حمراء فاتحة (bg-red-50)
- ✅ حدود حمراء (border-red-200)
- ✅ أيقونة تحذير حمراء
- ✅ نص "متأخر: X يوم"

---

### **2. دفعة قريبة الاستحقاق (أصفر - Warning)** 🟡

```
┌─────────────────────────────────────────┐
│ 🟡 دفعة مستحقة قريباً                  │
├─────────────────────────────────────────┤
│ برج المارينا - شقة 502                 │
│ مستأجر: سارة خالد الشامسي              │
│ المبلغ: AED 8,500                      │
│ متبقي: 3 أيام                          │
└─────────────────────────────────────────┘
```

**الخصائص:**
- ✅ خلفية صفراء فاتحة (bg-yellow-50)
- ✅ حدود صفراء (border-yellow-200)
- ✅ أيقونة ساعة صفراء
- ✅ نص "متبقي: X أيام"

---

## 📊 البيانات المعروضة

### **للعقارات السكنية:**

| الحقل | القيمة | مثال |
|-------|--------|------|
| اسم العقار | Property Name | فيلا الشاطئ |
| نوع العقار | سكني | (سكني) |
| نوع المستأجر | مستأجر | مستأجر: |
| اسم المستأجر | Tenant Name | أحمد محمد |
| المبلغ | Amount | AED 5,000 |
| تاريخ الاستحقاق | Due Date | 2025-10-15 |

---

### **للعقارات التجارية:**

| الحقل | القيمة | مثال |
|-------|--------|------|
| اسم العقار | Property Name | برج الأعمال |
| نوع العقار | تجاري | (تجاري) |
| نوع المستأجر | صاحب رخصة تجارية | صاحب رخصة تجارية: |
| الاسم التجاري | Business Name | شركة الأمل للتجارة |
| المبلغ | Amount | AED 15,000 |
| تاريخ الاستحقاق | Due Date | 2025-10-20 |

---

## 🎯 أمثلة كاملة

### **مثال 1: دفعة سكنية في التقويم**

```
┌──────────────────────────────────────────────┐
│ التقويم - 15 أكتوبر 2025                    │
├──────────────────────────────────────────────┤
│                                              │
│ 💰 دفعة مستحقة                              │
│                                              │
│ فيلا الشاطئ الذهبي (سكني)                   │
│ مستأجر: محمد عبدالله العتيبي                │
│ المبلغ: AED 5,000                           │
│                                              │
│ [دفعة] 09:00                                │
│                                              │
│ [عرض التفاصيل →]                            │
└──────────────────────────────────────────────┘
```

**التفاصيل الكاملة:**
- 🏠 العقار: فيلا الشاطئ الذهبي
- 📍 النوع: سكني
- 👤 المستأجر: محمد عبدالله العتيبي
- 💵 المبلغ: AED 5,000.00
- 📅 تاريخ الاستحقاق: 2025-10-15
- 🔗 الرابط: `/dashboard/leases/{leaseId}`

---

### **مثال 2: دفعة تجارية في التقويم**

```
┌──────────────────────────────────────────────┐
│ التقويم - 20 أكتوبر 2025                    │
├──────────────────────────────────────────────┤
│                                              │
│ 💰 دفعة مستحقة                              │
│                                              │
│ برج الأعمال (تجاري)                         │
│ صاحب رخصة تجارية: شركة الأمل للتجارة        │
│ المبلغ: AED 15,000                          │
│                                              │
│ [دفعة] 09:00                                │
│                                              │
│ [عرض التفاصيل →]                            │
└──────────────────────────────────────────────┘
```

**التفاصيل الكاملة:**
- 🏢 العقار: برج الأعمال
- 📍 النوع: تجاري
- 🏪 الاسم التجاري: شركة الأمل للتجارة
- 💵 المبلغ: AED 15,000.00
- 📅 تاريخ الاستحقاق: 2025-10-20
- 🔗 الرابط: `/dashboard/leases/{leaseId}`

---

### **مثال 3: إشعار دفعة متأخرة (Header)**

```
┌──────────────────────────────────────────────┐
│ 🔔 الإشعارات (3)                            │
├──────────────────────────────────────────────┤
│                                              │
│ ┌──────────────────────────────────────────┐ │
│ │ 🔴 دفعة متأخرة                          │ │
│ │                                          │ │
│ │ عقار النخيل - شقة 101                   │ │
│ │ مستأجر: أحمد محمد الكعبي                │ │
│ │ المبلغ: AED 45,000                      │ │
│ │ متأخر: 15 يوم                           │ │
│ │                                          │ │
│ │ [عرض التفاصيل →]                        │ │
│ └──────────────────────────────────────────┘ │
│                                              │
│ ┌──────────────────────────────────────────┐ │
│ │ 🟡 دفعة مستحقة قريباً                   │ │
│ │                                          │ │
│ │ برج المارينا - شقة 502                  │ │
│ │ مستأجر: سارة خالد                       │ │
│ │ المبلغ: AED 8,500                       │ │
│ │ متبقي: 3 أيام                           │ │
│ │                                          │ │
│ │ [عرض التفاصيل →]                        │ │
│ └──────────────────────────────────────────┘ │
│                                              │
│ [تعيين الكل كمقروء]                         │
└──────────────────────────────────────────────┘
```

---

## 🎨 الألوان والحالات

### **حالة الدفعة:**

| الحالة | اللون | الأيقونة | الوصف |
|--------|------|----------|-------|
| متأخرة | 🔴 أحمر | AlertCircle | دفعة تجاوزت تاريخ الاستحقاق |
| قريبة | 🟡 أصفر | Clock | دفعة خلال X أيام قادمة |
| عادية | 🟢 أخضر | Banknote | دفعة في التقويم |

---

## 🔧 الكود المستخدم

### **في التقويم (Calendar):**

```typescript
// db.ts - getCalendarEvents()

const [payments] = await connection.query(`
    SELECT 
        lp.id, 
        lp.leaseId, 
        lp.dueDate as date, 
        'Payment Due' as title, 
        'payment' as type, 
        lp.amount,
        p.name as propertyName,
        p.type as propertyType,
        t.name as tenantName,
        l.businessName
    FROM lease_payments lp
    JOIN leases l ON lp.leaseId = l.id
    JOIN units u ON l.unitId = u.id
    JOIN properties p ON u.propertyId = p.id
    JOIN tenants t ON l.tenantId = t.id
    WHERE lp.status != 'Paid'
`);

// معالجة النتائج
for (const event of payments) {
    const isCommercial = event.businessName && event.businessName.trim() !== '';
    const ownerName = isCommercial ? event.businessName : event.tenantName;
    const ownerType = isCommercial ? 'صاحب رخصة تجارية' : 'مستأجر';
    const propertyTypeAr = event.propertyType === 'residential' ? 'سكني' : 'تجاري';
    
    allEvents.push({
        id: `payment-${event.id}`,
        date: event.date,
        title: 'Payment Due',
        type: 'payment',
        link: `/dashboard/leases/${event.leaseId}`,
        details: `${event.propertyName} (${propertyTypeAr})\n${ownerType}: ${ownerName}\nالمبلغ: AED ${event.amount.toLocaleString()}`
    });
}
```

---

### **في الإشعارات (Notifications):**

```typescript
// notifications-dropdown.tsx

// دفعة متأخرة (أحمر)
{
  id: '1',
  type: 'payment',
  severity: 'urgent',
  title: 'دفعة متأخرة',
  description: 'عقار النخيل - شقة 101',
  link: '/dashboard/financials',
  date: pastDate,
  daysRemaining: -15,
  tenantName: 'أحمد محمد الكعبي',
  propertyType: 'residential',
  amount: '45,000'
}

// دفعة قريبة (أصفر)
{
  id: '2',
  type: 'payment',
  severity: 'warning',
  title: 'دفعة مستحقة قريباً',
  description: 'برج المارينا - شقة 502',
  link: '/dashboard/financials',
  date: futureDate,
  daysRemaining: 3,
  tenantName: 'سارة خالد',
  propertyType: 'residential',
  amount: '8,500'
}
```

---

## 📱 العرض المتجاوب

### **شاشات كبيرة (Desktop):**

```
┌─────────────────────────────────────────┐
│ التقويم                                 │
├─────────────┬───────────────────────────┤
│             │  💰 دفعة مستحقة           │
│  التقويم    │                           │
│             │  فيلا الشاطئ (سكني)       │
│   🗓️        │  مستأجر: أحمد محمد        │
│             │  المبلغ: AED 5,000        │
│             │                           │
│             │  [دفعة] 09:00             │
└─────────────┴───────────────────────────┘
```

---

### **شاشات صغيرة (Mobile):**

```
┌───────────────────────────┐
│ التقويم                   │
├───────────────────────────┤
│                           │
│ 💰 دفعة مستحقة            │
│                           │
│ فيلا الشاطئ (سكني)        │
│ مستأجر: أحمد محمد         │
│ المبلغ: AED 5,000         │
│                           │
│ [دفعة] 09:00              │
└───────────────────────────┘
```

---

## ✅ خلاصة المعلومات المعروضة

### **في التقويم:**
1. ✅ اسم العقار
2. ✅ نوع العقار (سكني/تجاري)
3. ✅ نوع المستأجر (مستأجر/صاحب رخصة تجارية)
4. ✅ اسم المستأجر أو الاسم التجاري
5. ✅ المبلغ المستحق
6. ✅ الوقت (09:00)

### **في الإشعارات:**
1. ✅ نوع الإشعار (متأخر/قريب)
2. ✅ اسم العقار + رقم الوحدة
3. ✅ اسم المستأجر
4. ✅ المبلغ
5. ✅ عدد الأيام (متأخر/متبقي)
6. ✅ رابط التفاصيل

---

## 🎯 التحسينات المطبقة

### **ما تم تحسينه:**

| قبل التحسين | بعد التحسين |
|-------------|-------------|
| المبلغ فقط | العقار + المستأجر + المبلغ |
| بدون تفريق | تفريق سكني/تجاري |
| معلومات بسيطة | معلومات شاملة ومفصلة |
| سطر واحد | عدة أسطر منظمة |

---

## 📞 للمزيد من المعلومات

- 📄 [دليل التقويم الكامل](./calendar-events-documentation.md)
- 🔔 [دليل الإشعارات](./TELEGRAM_SETUP_GUIDE.md)
- ⚙️ [إعدادات المستخدم](http://localhost:5000/dashboard/user-preferences)

---

**تاريخ التحديث:** أكتوبر 2025  
**الإصدار:** 2.0 - تحسينات شاملة
