# 💰 دليل إشعارات المصروفات - الشامل

## 📋 المحتويات
1. [نظرة عامة](#نظرة-عامة)
2. [أنواع إشعارات المصروفات](#أنواع-إشعارات-المصروفات)
3. [كيف تعمل الإشعارات](#كيف-تعمل-الإشعارات)
4. [الإعداد والتكوين](#الإعداد-والتكوين)
5. [أمثلة عملية](#أمثلة-عملية)

---

## 🎯 نظرة عامة

نظام إشعارات المصروفات يرسل تنبيهات فورية عبر:
- 🔔 **Header Notifications** - إشعارات في رأس الصفحة
- 📱 **Telegram** - رسائل فورية على تطبيق Telegram
- 📊 **Dashboard Notifications** - عرض في لوحة التحكم

---

## 📬 أنواع إشعارات المصروفات

### **3 أنواع رئيسية:**

| # | النوع | المستلم | الوقت |
|---|-------|---------|-------|
| 1 | 📋 مصروف جديد مقدم | المدراء/Admin | عند تقديم المصروف |
| 2 | ✅ مصروف موافق عليه | الموظف المقدم | عند الموافقة |
| 3 | ❌ مصروف مرفوض | الموظف المقدم | عند الرفض |

---

## 1️⃣ مصروف جديد مقدم (New Expense Submitted)

### **متى يُرسل:**
- ✅ عندما يقدم أي موظف مصروف جديد
- ✅ فوراً بعد الحفظ في قاعدة البيانات

### **من يستلمه:**
- 👥 جميع المدراء الذين لديهم صلاحية `expenses:approve`
- 📱 القناة الإدارية على Telegram (إذا تم تكوينها)

### **محتوى الإشعار:**

```
┌─────────────────────────────────────────┐
│ 📋 مصروف جديد مقدم                     │
├─────────────────────────────────────────┤
│                                         │
│ الموظف: أحمد محمد السعيد               │
│ الفئة: صيانة                           │
│ المبلغ: AED 750.00                     │
│ الوصف: إصلاح مكيف الوحدة 201          │
│ التاريخ: 2025-10-08                    │
│                                         │
│ يرجى مراجعته في لوحة التحكم.           │
│                                         │
│ [عرض التفاصيل] [موافقة] [رفض]         │
└─────────────────────────────────────────┘
```

### **على Telegram:**

```
📋 New Expense Submitted

Employee: أحمد محمد السعيد
Category: صيانة
Amount: AED 750
Description: إصلاح مكيف الوحدة 201

Please review it in the dashboard.
```

---

## 2️⃣ مصروف موافق عليه (Expense Approved)

### **متى يُرسل:**
- ✅ عندما يوافق مدير على المصروف
- ✅ فوراً بعد تغيير الحالة إلى "Approved"

### **من يستلمه:**
- 👤 الموظف الذي قدم المصروف
- 📱 Telegram الخاص بالموظف (إذا كان مكوّن)

### **محتوى الإشعار:**

```
┌─────────────────────────────────────────┐
│ ✅ تمت الموافقة على المصروف            │
├─────────────────────────────────────────┤
│                                         │
│ رقم المصروف: EXP-12345                │
│ الفئة: صيانة                           │
│ المبلغ: AED 750.00                     │
│                                         │
│ تمت الموافقة بواسطة: مدير النظام       │
│ التاريخ: 2025-10-08 14:30             │
│                                         │
│ ملاحظات المدير: معتمد للصرف            │
│                                         │
│ [عرض التفاصيل]                         │
└─────────────────────────────────────────┘
```

### **على Telegram:**

```
✅ Expense Approved!

Your expense request for صيانة 
(AED 750) has been approved.

Manager Notes: معتمد للصرف
```

---

## 3️⃣ مصروف مرفوض (Expense Rejected)

### **متى يُرسل:**
- ✅ عندما يرفض مدير المصروف
- ✅ فوراً بعد تغيير الحالة إلى "Rejected"

### **من يستلمه:**
- 👤 الموظف الذي قدم المصروف
- 📱 Telegram الخاص بالموظف (إذا كان مكوّن)

### **محتوى الإشعار:**

```
┌─────────────────────────────────────────┐
│ ❌ تم رفض المصروف                      │
├─────────────────────────────────────────┤
│                                         │
│ رقم المصروف: EXP-12345                │
│ الفئة: صيانة                           │
│ المبلغ: AED 750.00                     │
│                                         │
│ تم الرفض بواسطة: مدير النظام           │
│ التاريخ: 2025-10-08 14:30             │
│                                         │
│ ⚠️ سبب الرفض:                         │
│ المبلغ أعلى من السقف المسموح           │
│ يرجى تقديم عرض سعر أقل                │
│                                         │
│ [عرض التفاصيل] [تعديل وإعادة تقديم]   │
└─────────────────────────────────────────┘
```

### **على Telegram:**

```
❌ Expense Rejected

Your expense request for صيانة 
(AED 750) was rejected.

Manager Notes: المبلغ أعلى من السقف المسموح
```

---

## ⚙️ كيف تعمل الإشعارات

### **تدفق العمل:**

```
┌─────────────────┐
│ موظف يقدم مصروف │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ حفظ في DB       │
└────────┬────────┘
         │
         ▼
┌─────────────────────────────────┐
│ إرسال إشعار للمدراء:            │
│ • Header Notification          │
│ • Telegram (إذا مكوّن)         │
└────────┬────────────────────────┘
         │
         ▼
┌─────────────────┐
│ مدير يراجع      │
└────────┬────────┘
         │
         ├─── موافقة ─→ إشعار للموظف ✅
         │
         └─── رفض ────→ إشعار للموظف ❌
```

---

## 🔧 الإعداد والتكوين

### **الخطوة 1: تفعيل الإشعارات**

افتح:
```
http://localhost:5000/dashboard/user-preferences
```

### **الخطوة 2: اختر إشعارات المصروفات**

```
┌─────────────────────────────────────┐
│ 🔔 تفضيلات الإشعارات              │
├─────────────────────────────────────┤
│                                     │
│ ☑️ 📋 مصروف جديد مقدم             │
│    تلقى إشعار عند تقديم أي موظف   │
│    مصروف جديد                      │
│                                     │
│ ☑️ ✅ مصروف موافق عليه             │
│    تلقى إشعار عند الموافقة على    │
│    مصروفك                           │
│                                     │
│ ☑️ ❌ مصروف مرفوض                  │
│    تلقى إشعار عند رفض مصروفك      │
│                                     │
└─────────────────────────────────────┘
```

### **الخطوة 3: (اختياري) إعداد Telegram**

**للموظف:**
```
/dashboard/employees → تعديل معلوماتك
→ أدخل Bot Token + Chat ID
→ احفظ
```

**للنظام (قناة إدارية):**
```
في ملف .env:
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_ADMIN_CHANNEL_ID=@admin_channel
```

---

## 📱 عرض الإشعارات

### **في Header (رأس الصفحة):**

```
┌─────────────────────────────────────┐
│ 🏠 EstateFlow   [🔔 3]  👤 أحمد    │
├─────────────────────────────────────┤
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 📋 مصروف جديد مقدم             │ │
│ │ أحمد محمد - صيانة              │ │
│ │ AED 750                         │ │
│ │ منذ 5 دقائق                     │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [تعيين الكل كمقروء]                │
└─────────────────────────────────────┘
```

### **على Telegram:**

```
📱 Telegram
──────────────

EstateFlow Bot
14:30

📋 New Expense Submitted

Employee: أحمد محمد
Category: صيانة
Amount: AED 750
Description: إصلاح مكيف

Please review it in the dashboard.
```

---

## 🎯 من يستلم أي إشعار؟

### **جدول الاستلام:**

| نوع الإشعار | الموظف المقدم | المدراء | القناة الإدارية |
|-------------|---------------|----------|-----------------|
| **مصروف جديد** | ❌ | ✅ | ✅ |
| **موافق عليه** | ✅ | ❌ | ❌ |
| **مرفوض** | ✅ | ❌ | ❌ |

---

## 📊 الإحصائيات والتتبع

### **في لوحة التحكم:**

```
┌─────────────────────────────────────┐
│ 📊 إحصائيات المصروفات اليوم        │
├─────────────────────────────────────┤
│                                     │
│ 📋 مصروفات جديدة: 5                │
│ ✅ موافق عليها: 3                  │
│ ❌ مرفوضة: 1                        │
│ ⏳ قيد المراجعة: 1                 │
│                                     │
│ 💰 الإجمالي: AED 3,250             │
└─────────────────────────────────────┘
```

---

## 🔍 أمثلة عملية

### **مثال 1: موظف يقدم مصروف صيانة**

#### **الخطوة 1: الموظف يملأ النموذج**
```
┌─────────────────────────────────────┐
│ إضافة مصروف جديد                   │
├─────────────────────────────────────┤
│ الفئة: صيانة                       │
│ المبلغ: AED 750                    │
│ الوصف: إصلاح مكيف الوحدة 201      │
│ الإيصال: [صورة]                    │
│                                     │
│ [إرسال للموافقة]                   │
└─────────────────────────────────────┘
```

#### **الخطوة 2: المدير يستلم إشعار**
```
┌─────────────────────────────────────┐
│ 🔔 إشعار جديد (Header)              │
├─────────────────────────────────────┤
│ 📋 مصروف جديد مقدم                 │
│ أحمد محمد - صيانة                  │
│ AED 750                             │
│ [عرض]                               │
└─────────────────────────────────────┘

📱 Telegram (فوراً)
───────────────────
📋 New Expense Submitted
Employee: أحمد محمد
Category: صيانة
Amount: AED 750
```

#### **الخطوة 3: المدير يوافق**
```
┌─────────────────────────────────────┐
│ المدير في صفحة المصروفات           │
├─────────────────────────────────────┤
│ [✅ موافقة] [❌ رفض]               │
│         ↓                           │
│    يضغط موافقة                      │
└─────────────────────────────────────┘
```

#### **الخطوة 4: الموظف يستلم إشعار**
```
┌─────────────────────────────────────┐
│ 🔔 إشعار جديد (Header)              │
├─────────────────────────────────────┤
│ ✅ تمت الموافقة على مصروفك         │
│ صيانة - AED 750                    │
│ [عرض]                               │
└─────────────────────────────────────┘

📱 Telegram (فوراً)
───────────────────
✅ Expense Approved!
Your expense for صيانة 
(AED 750) has been approved.
```

---

### **مثال 2: مصروف مرفوض مع ملاحظات**

#### **المدير يرفض:**
```
┌─────────────────────────────────────┐
│ رفض المصروف                         │
├─────────────────────────────────────┤
│ الحالة: [مرفوض ▼]                  │
│                                     │
│ ملاحظات المدير:                    │
│ ┌─────────────────────────────────┐ │
│ │ المبلغ أعلى من المتوقع         │ │
│ │ يرجى الحصول على عرض سعر أقل   │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [حفظ التغييرات]                    │
└─────────────────────────────────────┘
```

#### **الموظف يستلم:**
```
┌─────────────────────────────────────┐
│ 🔔 إشعار جديد                       │
├─────────────────────────────────────┤
│ ❌ تم رفض مصروفك                   │
│                                     │
│ صيانة - AED 750                    │
│                                     │
│ ⚠️ سبب الرفض:                     │
│ المبلغ أعلى من المتوقع             │
│ يرجى الحصول على عرض سعر أقل        │
│                                     │
│ [عرض] [تعديل وإعادة تقديم]         │
└─────────────────────────────────────┘

📱 Telegram
───────────
❌ Expense Rejected
Category: صيانة (AED 750)

Manager Notes:
المبلغ أعلى من المتوقع
يرجى الحصول على عرض سعر أقل
```

---

## 🎨 الألوان والأيقونات

### **في Header Notifications:**

| النوع | اللون | الأيقونة |
|-------|------|----------|
| مصروف جديد | 🔵 أزرق | 📋 |
| موافق عليه | 🟢 أخضر | ✅ |
| مرفوض | 🔴 أحمر | ❌ |

---

## 🔔 في التقويم

### **المصروفات تظهر في التقويم:**

```
┌─────────────────────────────────────┐
│ 📅 8 أكتوبر 2025                    │
├─────────────────────────────────────┤
│                                     │
│ 🧾 مصروف مقدم (14:30)              │
│                                     │
│ صيانة: AED 750                     │
│ بواسطة: أحمد محمد                  │
│                                     │
│ [مصروف] 14:30                      │
└─────────────────────────────────────┘
```

**يمكنك إخفاء/إظهار المصروفات من التقويم:**
```
/dashboard/user-preferences
→ إعدادات عرض التقويم
→ ☐ المصروفات [إيقاف]
```

---

## ⚙️ التحكم في الإشعارات

### **لكل موظف:**

```
┌─────────────────────────────────────┐
│ تفضيلات إشعارات المصروفات          │
├─────────────────────────────────────┤
│                                     │
│ إذا كنت موظف عادي:                │
│ ☑️ موافقة على مصروفي              │
│ ☑️ رفض مصروفي                      │
│ ☐ مصروف جديد (للمدراء فقط)        │
│                                     │
│ إذا كنت مدير:                      │
│ ☑️ مصروف جديد مقدم (من أي موظف)   │
│ ☑️ موافقة على مصروفي              │
│ ☑️ رفض مصروفي                      │
└─────────────────────────────────────┘
```

---

## 📊 إحصائيات الإشعارات

### **عدد الإشعارات المرسلة يومياً:**

```
┌───────────────────────────────┐
│ النوع          | العدد        │
├───────────────────────────────┤
│ مصروف جديد     | 15          │
│ موافق عليه     | 12          │
│ مرفوض          | 3           │
├───────────────────────────────┤
│ الإجمالي       | 30          │
└───────────────────────────────┘
```

---

## 🎯 نصائح مهمة

### **للموظفين:**
1. ✅ تأكد من تفعيل إشعارات "موافقة/رفض"
2. ✅ راجع الإشعارات بانتظام
3. ✅ اقرأ ملاحظات المدير بعناية
4. ✅ عدّل وأعد تقديم إذا رُفض

### **للمدراء:**
1. ✅ فعّل إشعار "مصروف جديد"
2. ✅ راجع المصروفات بسرعة
3. ✅ اكتب ملاحظات واضحة عند الرفض
4. ✅ استخدم Telegram للمتابعة الفورية

---

## 🔗 الروابط والصفحات

### **صفحة المصروفات:**
```
http://localhost:5000/dashboard/expenses
```

### **صفحة التفضيلات:**
```
http://localhost:5000/dashboard/user-preferences
```

### **إدارة الموظفين (لتكوين Telegram):**
```
http://localhost:5000/dashboard/employees
```

---

## 📋 قائمة التحقق

### **للإعداد الكامل:**

```
☐ 1. افتح صفحة التفضيلات
☐ 2. فعّل إشعارات المصروفات
☐ 3. (اختياري) كوّن Telegram
☐ 4. احفظ التغييرات
☐ 5. جرّب بتقديم مصروف تجريبي
☐ 6. تحقق من استلام الإشعار
☐ 7. جرّب الموافقة/الرفض
☐ 8. تحقق من وصول الإشعار للموظف
```

---

## 🎉 الملخص النهائي

### **إشعارات المصروفات:**

| الميزة | الحالة |
|--------|--------|
| إشعار عند التقديم | ✅ يعمل |
| إشعار عند الموافقة | ✅ يعمل |
| إشعار عند الرفض | ✅ يعمل |
| دعم Telegram | ✅ يعمل |
| دعم Header | ✅ يعمل |
| التحكم في التفضيلات | ✅ يعمل |
| عرض في التقويم | ✅ يعمل |

---

## 📞 للمزيد

- 📱 [إعداد Telegram](./TELEGRAM_SETUP_GUIDE.md)
- 📋 [البداية السريعة](./TELEGRAM_QUICK_START_AR.md)
- 📸 [الدليل المصور](./TELEGRAM_VISUAL_GUIDE_AR.md)

---

**🎉 جميع إشعارات المصروفات تعمل بشكل كامل!**

**تاريخ التحديث:** أكتوبر 2025  
**الإصدار:** 1.0
